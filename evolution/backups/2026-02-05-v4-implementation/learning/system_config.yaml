# =============================================================================
# CONFIGURACIÓN EVOLUTIVA DEL SISTEMA
# =============================================================================
# Este archivo contiene los parámetros que Claude puede modificar basándose
# en la experiencia y feedback del usuario.
#
# A diferencia de config/rules.yaml (reglas fijas), estos parámetros EVOLUCIONAN.
# =============================================================================

# -----------------------------------------------------------------------------
# VERSIÓN Y CHANGELOG
# -----------------------------------------------------------------------------
version: 1.0
last_modified: 2026-01-26
modification_history: []
  # - date: 2026-02-15
  #   change: "Reducido max_position_emerging de 10% a 5%"
  #   reason: "Lección de pérdida en BABA - riesgo político subestimado"
  #   triggered_by: "investment_loss"

# -----------------------------------------------------------------------------
# PARÁMETROS DE POSICIÓN (pueden evolucionar)
# -----------------------------------------------------------------------------
position_parameters:
  # Límites base - SISTEMA V2.0 DIVERSIFICADO
  max_position_core: 7            # Core conviction, máx 6-7 posiciones
  max_position_standard: 5        # Standard value, bulk portfolio
  max_position_opportunistic: 3   # Turnarounds, especiales

  target_positions: 18            # Target 16-20 posiciones
  min_positions: 16
  max_positions: 20

  max_sector_pct: 25              # Más estricto que antes (era 30%)
  min_sectors: 5                  # Mínimo diversificación sectorial

  max_geography_pct: 35           # Nueva regla
  min_geographies: 4              # Mínimo diversificación geográfica

  min_cash_pct: 5                 # Absoluto mínimo
  target_cash_pct: 12             # Objetivo normal
  max_cash_pct: 15                # Máximo antes de forzar inversión

  # Límites legacy (deprecated, usar nuevos)
  max_position_by_risk:
    core_conviction: 7      # Moat fuerte, margen >30%
    standard_value: 5       # Value sólido, margen >25%
    opportunistic: 3        # Turnarounds, margen >35%

  # Límites por geografía (sin cambios)
  max_position_by_geography:
    europe: 7
    us: 7
    japan: 7
    uk: 7
    china: 5              # Reducido por riesgo político
    emerging_other: 5

# -----------------------------------------------------------------------------
# ESTRUCTURA DE PORTFOLIO - SISTEMA V2.0
# -----------------------------------------------------------------------------
portfolio_structure:
  # Targets de composición
  defensive_target_pct: 37.5      # Midpoint 35-40%
  defensive_min_pct: 35
  defensive_max_pct: 40

  cyclical_target_pct: 47.5       # Midpoint 45-50%
  cyclical_min_pct: 45
  cyclical_max_pct: 50

  opportunistic_max_pct: 5        # 0-5%, solo si buenas oportunidades

  cash_target_pct: 12             # Midpoint 10-15%
  cash_min_pct: 5                 # Absoluto mínimo
  cash_max_pct: 15

  # Clasificación sectores
  defensive_sectors:
    - utilities
    - consumer_staples
    - healthcare
    - pharma
    - insurance_life

  cyclical_sectors:
    - energy
    - automotive
    - industrials
    - financials
    - insurance_pc
    - telecom
    - materials
    - real_estate

  # Posiciones target
  defensive_positions_target: 7-8
  cyclical_positions_target: 9-11
  opportunistic_positions_target: 0-3

# -----------------------------------------------------------------------------
# REBALANCEO - SISTEMA V2.0
# -----------------------------------------------------------------------------
rebalancing:
  # Scheduled
  frequency_days: 30                    # Mensual
  next_rebalance: 2026-02-03            # Primer lunes febrero

  # Trigger-based
  trigger_position_deviation_pct: 30    # ±30% de target
  trigger_sector_max_pct: 27            # >25% + buffer 2%
  trigger_geography_max_pct: 37         # >35% + buffer 2%
  trigger_cash_min_pct: 5               # Crítico
  trigger_cash_max_pct: 15              # Forzar inversión

  # Método
  method: trim_and_redistribute
  trim_to_target: true                  # Siempre trim exacto a target
  add_only_if_thesis_intact: true

# -----------------------------------------------------------------------------
# PARÁMETROS DE VALORACIÓN (pueden evolucionar)
# -----------------------------------------------------------------------------
valuation_parameters:
  min_margin_of_safety_pct: 25
  
  # Ajustes por sector (aprende qué múltiplos son "normales")
  sector_typical_valuations:
    automotive:
      pe_range: [5, 12]
      pb_range: [0.3, 1.0]
      notes: "Cíclico, comprar en parte baja del ciclo"
    
    energy_traditional:
      pe_range: [6, 12]
      ev_ebitda_range: [3, 6]
      notes: "Enfocarse en FCF y dividendo, no en P/E"
    
    utilities:
      pe_range: [10, 18]
      div_yield_attractive: 5
      notes: "Estables, comprar cuando yield > 5%"
    
    technology:
      notes: "Varía mucho, usar PEG para growth"
    
    # Se añaden más según se analicen sectores

# -----------------------------------------------------------------------------
# PARÁMETROS DE TIMING (pueden evolucionar)
# -----------------------------------------------------------------------------
timing_parameters:
  # Reglas aprendidas sobre cuándo comprar/no comprar
  avoid_buying:
    - days_before_earnings: 14      # No comprar 2 semanas antes de earnings
    - during_falling_knife: true    # Esperar estabilización
    - fed_decision_week: true       # Esperar después de decisión Fed
  
  prefer_buying:
    - after_earnings_overreaction: true   # Caídas >10% post-earnings sin daño a thesis
    - extreme_pessimism_indicators:
        - sector_pe_below_5y_avg_pct: 30  # Sector 30% más barato que media
        - div_yield_above_history_pct: 50 # Dividendo 50% mayor que histórico

# -----------------------------------------------------------------------------
# PARÁMETROS DE COMUNICACIÓN (aprende del usuario)
# -----------------------------------------------------------------------------
communication_style:
  # Nivel de detalle preferido por el usuario
  detail_level: medium    # low / medium / high
  
  # Frecuencia de updates preferida
  update_frequency: on_change  # daily / weekly / on_change
  
  # Formato de recomendaciones
  recommendation_format: concise  # concise / detailed
  
  # Idioma de análisis técnicos
  technical_language: accessible  # accessible / expert
  
  # Preferencias aprendidas
  user_preferences:
    prefers_charts: false
    prefers_tables: true
    wants_macro_context: true
    wants_geopolitics: true
    risk_tolerance: medium    # conservative / medium / aggressive

# -----------------------------------------------------------------------------
# PARÁMETROS DE ANÁLISIS (pueden evolucionar)
# -----------------------------------------------------------------------------
analysis_parameters:
  # Factores a priorizar (orden = importancia)
  factor_priority:
    - moat_quality
    - valuation
    - management
    - balance_sheet
    - growth
  
  # Pesos aprendidos (se ajustan con experiencia)
  factor_weights:
    moat_quality: 0.30
    valuation: 0.25
    management: 0.15
    balance_sheet: 0.15
    growth: 0.10
    momentum: 0.05
  
  # Red flags que descalifican automáticamente
  automatic_disqualifiers:
    - accounting_irregularities: true
    - management_fraud_history: true
    - debt_to_ebitda_above: 5
    - negative_fcf_years_consecutive: 3

# -----------------------------------------------------------------------------
# PARÁMETROS DE RIESGO (pueden evolucionar)
# -----------------------------------------------------------------------------
risk_parameters:
  # Correlación máxima entre posiciones
  max_correlation_between_positions: 0.7
  
  # Exposición máxima a factores de riesgo
  max_exposure_to:
    china_revenue_pct: 30           # Máx empresas con >30% revenue de China
    high_debt_companies: 3          # Máx número de empresas con deuda alta
    turnaround_plays: 2             # Máx número de turnarounds simultáneos
  
  # Lecciones de riesgo aplicadas
  risk_lessons_active:
    # - lesson_id: "baba_china_risk"
    #   applied: "Reducir max posición China a 5%"
    #   date_applied: 2026-04-15

# -----------------------------------------------------------------------------
# REGLAS DINÁMICAS (creadas por aprendizaje)
# -----------------------------------------------------------------------------
# Reglas que el sistema ha creado basándose en experiencia
# -----------------------------------------------------------------------------

learned_rules: []
  # - id: "rule_001"
  #   created: 2026-04-15
  #   trigger: "Pérdida >20% en BABA por riesgo político"
  #   rule: "Para empresas chinas, requerir margen de seguridad >40%"
  #   rationale: "El riesgo de intervención gubernamental justifica descuento extra"
  #   active: true
  
  # - id: "rule_002"
  #   created: 2026-06-20
  #   trigger: "3 de 4 inversiones en dividendos altos fueron exitosas"
  #   rule: "Priorizar empresas con div yield >5% en sectores odiados"
  #   rationale: "Patrón consistente de éxito"
  #   active: true

# -----------------------------------------------------------------------------
# FEEDBACK DEL USUARIO (para aprender preferencias)
# -----------------------------------------------------------------------------

user_feedback_log: []
  # - date: 2026-02-10
  #   feedback: "Los análisis son muy largos, prefiero más concisos"
  #   action_taken: "Reducir detail_level a 'concise'"
  #   parameter_changed: "communication_style.detail_level"
  
  # - date: 2026-03-05
  #   feedback: "Me gustaría más contexto geopolítico"
  #   action_taken: "Añadir geopolítica a todos los análisis macro"
  #   parameter_changed: "user_preferences.wants_geopolitics = true"

# -----------------------------------------------------------------------------
# AUTO-EVALUACIÓN PERIÓDICA
# -----------------------------------------------------------------------------

self_evaluation:
  last_evaluation: null
  next_evaluation: null   # Cada 3 meses
  
  metrics_to_track:
    - win_rate
    - avg_return
    - sharpe_ratio_estimate
    - max_drawdown
    - avg_holding_period
  
  questions_to_answer:
    - "¿Las reglas actuales están funcionando?"
    - "¿Hay patrones de error repetitivos?"
    - "¿Qué lecciones no se están aplicando?"
    - "¿El usuario está satisfecho con el sistema?"
