# =============================================================================
# PORTFOLIO HISTORY - Closed Positions Track Record
# =============================================================================
# Purpose: Track all closed positions for performance evaluation
# Updated: After each SELL that closes a position
# Schema: entry/exit dates, prices, P&L, thesis accuracy assessment
# =============================================================================

# Metadata
metadata:
  created: 2026-02-03
  last_updated: 2026-02-04
  total_closed: 2
  total_pnl_eur: -22.85
  win_rate: 0.0  # % of positions that were profitable
  avg_holding_days: 3

# Closed Positions
closed_positions:
  # Template for each closed position:
  # - ticker: SYMBOL
  #   name: "Company Name"
  #   entry_date: YYYY-MM-DD
  #   exit_date: YYYY-MM-DD
  #   shares: N
  #   entry_price: X.XX
  #   exit_price: X.XX
  #   entry_currency: EUR/USD/GBp
  #   invested: X.XX  # Total amount invested (local currency)
  #   proceeds: X.XX  # Total amount received (local currency)
  #   pnl_amount: X.XX  # Profit/Loss amount
  #   pnl_percent: X.XX  # Profit/Loss %
  #   holding_days: N
  #   thesis_fv_at_entry: X.XX  # Fair value from thesis at entry
  #   fv_reached: true/false  # Did price reach 80%+ of FV?
  #   thesis_accuracy:
  #     correct: true/false  # Was the thesis correct in hindsight?
  #     notes: "Brief assessment"
  #   exit_reason: "sell_at_fv|stop_loss|thesis_invalidated|rebalance|error"

  - ticker: ENEL.MI
    name: "Enel S.p.A."
    entry_date: 2026-01-27
    exit_date: 2026-01-31
    shares: 81
    entry_price: 9.225
    exit_price: 9.225
    entry_currency: EUR
    invested_eur: 747.00
    proceeds_eur: 747.00
    pnl_amount: 0.00
    pnl_percent: 0.0
    holding_days: 4
    thesis_fv_at_entry: null  # No formal thesis was written
    fv_reached: false
    thesis_accuracy:
      correct: null  # Position closed before thesis could be validated
      notes: "Sold because bought at fair value without margin of safety (error in process). No loss, but opportunity cost. Recognized process failure and corrected."
    exit_reason: error  # Bought without proper thesis/MoS

  - ticker: FUTR.L
    name: "Future plc"
    entry_date: 2026-02-03
    exit_date: 2026-02-04
    shares: 111
    entry_price_gbp: 536.40  # Weighted avg: (47*532 + 64*539.5)/111
    exit_price_gbp: 522.50
    entry_currency: GBp
    invested_eur: 695.05  # $817.40 / 1.1762 (avg FX)
    proceeds_eur: 672.20
    pnl_amount_eur: -22.85
    pnl_percent: -2.8
    holding_days: 1
    thesis_fv_at_entry: 1100  # GBp - original thesis
    thesis_fv_v2: 1050  # GBp - v2.0 re-evaluation
    fv_reached: false
    quality_score: 32  # Tier D - reason for exit
    thesis_accuracy:
      correct: null  # Position closed before thesis could be validated
      notes: "Framework v3.0 Tier D violation. QS 32/100 = DO NOT HOLD. Value trap 4/10 factors (secular decline, tech disruption, ROIC<WACC, high goodwill). MoS was 46-53% but quality insufficient. Disciplined exit to redeploy capital to Tier A/B compounders."
    exit_reason: thesis_invalidated  # Framework v3.0 upgrade revealed quality issue
    lesson_learned: "v2.0 portfolio built on P/E+yield screening missed quality dimension. Framework v3.0 Quality Score is essential filter BEFORE valuation."

# Partial Sells (Trims) - Not full exits, but record for P&L tracking
partial_sells:
  - ticker: SHEL.L
    date: 2026-01-31
    shares_sold: 20
    shares_remaining: 20.85
    price_gbx: 2689
    proceeds_approx_eur: 285.00
    pnl_approx_eur: 285.00
    reason: "TRIM - Position 23.9% exceeded 7% max limit"

  - ticker: SHEL.L
    date: 2026-02-02
    shares_sold: 10
    shares_remaining: 10.85
    price_gbx: 2700  # Approx
    proceeds_approx_eur: 150.00
    pnl_approx_eur: 50.00
    reason: "TRIM 2 - Continued rebalancing from 20.85 to 10.85 shares"

  - ticker: DTE.DE
    date: 2026-02-03
    shares_sold: 14
    shares_remaining: 23.62
    total_usd: 396.96
    pnl_approx_eur: 70.00  # Estimated gain
    reason: "TRIM - Position 11.3% exceeded 7% max limit"

# Statistics (auto-calculated by effectiveness_tracker.py)
statistics:
  # Will be populated by the tool
  total_closed_positions: 1
  total_partial_sells: 3
  total_realized_pnl_eur: 405.00  # Approx from trims
  winners: 0
  losers: 0
  breakeven: 1
  win_rate_pct: null  # Not meaningful with 1 position
  avg_win_pct: null
  avg_loss_pct: null
  avg_holding_days: 4
  positions_reached_fv: 0
  thesis_accuracy_rate: null
